<html lang="zh" data-theme="dark">
<head>
    <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>本人对 Stable Diffusion 的全部探索 | Eru&#39;s Home</title>

<link rel="shortcut icon" href="https://blog.sxjeru.top/favicon.ico?v=1666511703205">

<link href="https://fastly.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://blog.sxjeru.top/styles/main.css">

<!-- <link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css"> -->
<!-- <script src="https://fastly.jsdelivr.net/npm/moment@2.27.0/moment.min.js"></script> -->
<!-- <script src="https://fastly.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script> -->
<!-- <script src="https://fastly.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script> -->
<!-- <script src="https://fastly.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js"></script> -->
<!-- DEMO JS -->
<!--<script src="media/scripts/index.js"></script>-->


<script async src="https://www.googletagmanager.com/gtag/js?id=UA-127772764-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());
    gtag('config', 'UA-127772764-1');
</script>


    
<link rel="stylesheet" href="https://fastly.jsdelivr.net/gh/highlightjs/cdn-release@11.3.1/build/styles/base16/solarized-light.min.css">

<script src="https://fastly.jsdelivr.net/combine/gh/highlightjs/cdn-release@11.3.1/build/highlight.min.js,gh/highlightjs/cdn-release@11.3.1/build/languages/cpp.min.js,gh/highlightjs/cdn-release@11.3.1/build/languages/csharp.min.js,gh/highlightjs/cdn-release@11.3.1/build/languages/c.min.js,gh/highlightjs/cdn-release@11.3.1/build/languages/python.min.js,gh/highlightjs/cdn-release@11.3.1/build/languages/rust.min.js,gh/highlightjs/cdn-release@11.3.1/build/languages/xml.min.js,gh/highlightjs/cdn-release@11.3.1/build/languages/javascript.min.js,gh/highlightjs/cdn-release@11.3.1/build/languages/powershell.min.js,gh/highlightjs/cdn-release@11.3.1/build/languages/shell.min.js,gh/highlightjs/cdn-release@11.3.1/build/languages/sql.min.js,gh/highlightjs/cdn-release@11.3.1/build/languages/http.min.js,gh/highlightjs/cdn-release@11.3.1/build/languages/go.min.js,gh/highlightjs/cdn-release@11.3.1/build/languages/css.min.js"></script>

<!-- <script src="https://fastly.jsdelivr.net/gh/highlightjs/cdn-release@11.3.1/build/highlight.min.js"></script>
<script src="https://fastly.jsdelivr.net/gh/highlightjs/cdn-release@11.3.1/build/languages/cpp.min.js"></script>
<script src="https://fastly.jsdelivr.net/gh/highlightjs/cdn-release@11.3.1/build/languages/csharp.min.js"></script>
<script src="https://fastly.jsdelivr.net/gh/highlightjs/cdn-release@11.3.1/build/languages/c.min.js"></script>
<script src="https://fastly.jsdelivr.net/gh/highlightjs/cdn-release@11.3.1/build/languages/python.min.js"></script>
<script src="https://fastly.jsdelivr.net/gh/highlightjs/cdn-release@11.3.1/build/languages/rust.min.js"></script>
<script src="https://fastly.jsdelivr.net/gh/highlightjs/cdn-release@11.3.1/build/languages/xml.min.js"></script>
<script src="https://fastly.jsdelivr.net/gh/highlightjs/cdn-release@11.3.1/build/languages/javascript.min.js"></script>
<script src="https://fastly.jsdelivr.net/gh/highlightjs/cdn-release@11.3.1/build/languages/powershell.min.js"></script>
<script src="https://fastly.jsdelivr.net/gh/highlightjs/cdn-release@11.3.1/build/languages/shell.min.js"></script>
<script src="https://fastly.jsdelivr.net/gh/highlightjs/cdn-release@11.3.1/build/languages/sql.min.js"></script>
<script src="https://fastly.jsdelivr.net/gh/highlightjs/cdn-release@11.3.1/build/languages/http.min.js"></script>
<script src="https://fastly.jsdelivr.net/gh/highlightjs/cdn-release@11.3.1/build/languages/go.min.js"></script>
<script src="https://fastly.jsdelivr.net/gh/highlightjs/cdn-release@11.3.1/build/languages/css.min.js"></script>
 -->

    <script src="https://fastly.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script>mermaid.initialize({startOnLoad:true});</script>

    <link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/viewerjs@1.10.2/dist/viewer.min.css" />
<script src="https://fastly.jsdelivr.net/npm/viewerjs@1.10.2/dist/viewer.min.js"></script>

    <link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/katex@0.12.0/dist/katex.css">
</head>
<body>
<div class="main gt-bg-theme-color-first">
    <nav class="navbar navbar-expand-lg">
    <a class="navbar-brand" href="/">
        <img class="user-avatar" src="/images/avatar.png" alt="头像">
        <div class="site-name gt-c-content-color-first">
            Eru&#39;s Home
        </div>
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation" id="changeNavbar">
        <i class="fas fa-bars gt-c-content-color-first" style="font-size: 18px"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div class="navbar-nav mr-auto" style="text-align: center">
            
            <div class="nav-item">
                
                <a href="/" class="menu gt-a-link">
                    首页
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/post/about" class="menu gt-a-link">
                    关于
                </a>
                
            </div>
            
        </div>
        <div style="text-align: center">
            <form id="gridea-search-form" style="position: relative" data-update="1666511703205"
                action="/search/">
                <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="搜索文章" />
                <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
        </div>
    </div>
</nav>
<script>
    /* 移动端导航栏展开/收起切换 */
    document.getElementById('changeNavbar').onclick = function () {
        var element = document.getElementById('navbarSupportedContent');
        if (element.style.display === 'none' || element.style.display === '') {
            element.style.display = 'block';
        } else {
            element.style.display = 'none';
        }
    }
</script>

    <div class="post-container">
        <div class="post-detail gt-bg-theme-color-second">
            <article class="gt-post-content">
                <h2 class="post-title">
                    本人对 Stable Diffusion 的全部探索
                </h2>
                <div class="post-info">
                    <time class="post-time gt-c-content-color-first">
                        · 2022-10-16 ★ 10:38 ·
                    </time>
                    
                </div>
                <div class="post-content">
                    <p>随着10月7日的 NovelAI 模型“泄漏”事件，利用SD生成图片便开始大火。咱作为一穷学生，手头唯一有过的显卡，还是亮机用的 ATI HD 4600，因此只能去<strong>借用</strong>云GPU资源了。</p>
<p>下面会给出一些SD相关的资源，教你如何在云上跑，以及个人生成的可供欣赏的图片。(大概会持续更新)</p>
<!-- more -->
<hr>
<p>关于本地搭建，由于咱没有实际操作过，所说的一切都是纸上谈兵，所以还是丢几个教程罢。</p>
<ul>
<li><a href="https://github.com/AUTOMATIC1111/stable-diffusion-webui/wiki" target="_blank">SD web UI 官方 Wiki</a></li>
<li><a href="https://my.minecraft.kim/tech/824/" target="_blank">群友写的教程，质量不错</a></li>
<li><a href="https://gist.github.com/crosstyan/f912612f4c26e298feec4a2924c41d99" target="_blank">SD Chinese FAQ</a></li>
</ul>
<p>部署时请注意网络环境，“系统代理”可能不起作用，请自行更改为 TUN隧道 (虚拟网卡/VPN) 模式，<br>
或搜索“git/pip 代理设置/镜像站设置”。</p>
<hr>
<p id="cloud">若是想借助云GPU，咱在这方面作了不少探究，目前来说有这么几种方式：<br>
(一个配套的<a href="https://github.com/sxjeru/stable-diffusion-webui-freeCloud" target="_blank">GitHub仓库</a>，配合食用)</p>
<h3 id="1-google-colab-font-colorcyan需架梯优先考虑font">1. Google Colab <font color=Cyan>(需架梯，优先考虑)</font></h3>
<p>Google 大气！直接免费给 Tesla T4，应该是能免费拿到的最好的 GPU 了。缺点是内存略少，配额也略少。<br>
它的分配大概是按GPU用量计算，间断生成每天大概能跑 1.5-2h，配额用尽自动停机。<font color=FFFFCC>(戏称 AI 防沉迷)</font></p>
<p>需要注意的是，该方案要求有<font color=#ff6969>稳定的互联网连接</font>，否则断线后可能会需要重新配置环境，浪费配额。</p>
<p><strong>推荐 notebook：<a href="https://colab.research.google.com/github/TheLastBen/fast-stable-diffusion/blob/main/fast_stable_diffusion_AUTOMATIC1111.ipynb" target="_blank">Fast SD</a></strong></p>
<p>由于 Colab 内存限制，请配合较小的模型使用，这里建议转存 <a href="https://drive.google.com/drive/folders/1jLrwCGaQTU1FQFG8z_KWI0nYZmDE6znI?usp=sharing" target="_blank">animefull-final-pruned</a>.<br>
在“Model Download/Load”模块填入分享链接或转存后的路径，然后依次运行所有单元格即可。</p>
<p>备选：<a href="https://colab.research.google.com/drive/1_Ma71L6uGbtt6UQyA3FjqW2lcZ5Bjck-" target="_blank"><strong>中文版 NovelAI官方前端</strong></a>、<a href="https://colab.research.google.com/github/altryne/sd-webui-colab/blob/main/Stable_Diffusion_WebUi_Altryne.ipynb" target="_blank">by Altryne</a>、<a href="https://colab.research.google.com/drive/1Iy-xW9t1-OQWhb0hNxueGij8phCyluOh" target="_blank">SD Voldemort</a><details><summary>下图为基准测试，即 t2i 默认配置下的生成速度，点击查看。(仅供参考，实际不是很稳)</summary><img src="https://file.sxjeru.top/Blog/images/22.png" alt="" loading="lazy"></details></p>
<h3 id="2-paperspace-font-colorcyan稳定免费-6hfont">2. Paperspace <font color=Cyan>(稳定免费 6h)</font></h3>
<p>这家提供的是 Quadro M4000，性能不强，不过内存倒是给够了。<br>
实行先到先得机制，可能会有免费机子耗尽的情况，目前来说<strong>只要多次刷新就能刷出可用机子</strong>，抢到便可完整用6小时。<br>
这家的永久存储空间只给了 5GB，相当于每次运行都要重新下载模型，不过目前来说下载速度可观，影响不大。</p>
<p><strong>官方引导 (En)：<a href="https://github.com/Engineer-of-Stuff/stable-diffusion-paperspace/blob/main/docs/Paperspace%20Guide%20for%20Idiots.md" target="_blank">SD Paperspace</a></strong></p>
<p>注册时需要手机号。<br>
创建项目时若没有免费的机子，可以刷新一下，或换个时间。<br>
notebook 中第一个单元格需要手动去掉 2-5 行注释。下载模型推荐“animefull-final-pruned”，可选下载 Hypernetworks 部分。其余请根据说明运行，祝成功。<details><summary>下图为基准测试，点击查看，注意单位为较慢的“s/it”。</summary><img src="https://file.sxjeru.top/Blog/images/23.png" alt="" loading="lazy"></details></p>
<h3 id="3-kaggle-font-colorcyan一周至少免费-30hfont">3. Kaggle <font color=Cyan>(一周至少免费 30h)</font></h3>
<p>这家提供了 Tesla P100-PCIE，性能中上。虽然内存也不是很多，但这里内存占满不会像 Colab 一样强退进程，而是会缓慢持续运行。加上免费时间充足，存储空间也给不少，所以值得一试~</p>
<p>今天突然发现它有提供 Tesla T4 x2，太香了！基准测试见后。</p>
<p><strong>推荐 notebook：<a href="https://www.kaggle.com/code/akaneninomiya/stablediffusionui-adapted-to-novelaileaks" target="_blank">StableDiffusionUI</a></strong></p>
<p>先注册账号，然后进入上面的网址，选择右上角<code>Copy &amp; Edit</code>，更改右侧“Settings”中的<code>ACCELERATOR</code>为 GPU，<br>
<code>PERSISTENCE</code>为 Files only，并打开<code>Internet on</code>选项。</p>
<p>若无法切换到 GPU，请先前往右侧下方提示处验证手机号。<br>
首次需执行除最后外的所有单元格，往后一般只需执行倒数第二个单元格即可。<br>
开启底部“Console”，便于查看日志输出。<details><summary>下图为基准测试，点击查看。(先 T4 x2，后 P100)</summary><img src="https://file.sxjeru.top/Blog/images/25.png" alt="" loading="lazy"><img src="https://file.sxjeru.top/Blog/images/24.png" alt="" loading="lazy"></details></p>
<h3 id="4-amazon-sagemaker-studio-lab-font-colorcyan免费稳定-4hfont">4. Amazon SageMaker Studio Lab <font color=Cyan>(免费稳定 4h)</font></h3>
<p>这家给的也是 Tesla T4，4核 CPU，16G 内存，15GB 存储空间。<br>
配额是连续可用 4h，24h 内可用 8h。<br>
注册账号无法立刻拿到，需要排几天的队等待审核。</p>
<p><s>存在各种问题，暂时无法用于生产。请等待后续探究。</s><br>
问题主要在于不给 root 权限，加上 gradio 无法连接，好在都能解决。</p>
<p>自制 notebook：<a href="https://studiolab.sagemaker.aws/import/github/sxjeru/stable-diffusion-webui-freeCloud/blob/main/amazon-stablediffusionui-adapted-to-novelaileaks.ipynb"><img  src="https://studiolab.sagemaker.aws/studiolab.svg" alt="Open In SageMaker Studio Lab" style="vertical-align: middle; margin: 0;"/></a></p>
<p>启动前记得将“Compute type”改为 GPU。<br>
首次需运行除最后外的所有单元格，往后一般只需运行倒数第二个单元格。<br>
存在无法正常运行的可能，如果无法独立解决，请考虑其他平台。<details><summary>下图基准测试，点击查看。</summary><img src="https://file.sxjeru.top/Blog/images/26.png" alt="" loading="lazy"></details></p>
<hr>
<h3 id="最后说几点注意事项">最后说几点注意事项：</h3>
<ul>
<li><code>--share</code>带的 Gradio 服务，似乎存在断连问题，即webui假死之类，需要刷新重新配置才可。不论有无代理都如此；(更新 webui 后可用 ngrok 替代，亲测体验不错)</li>
<li>根据实际资源使用情况，合理添加<code>--medvram</code>、<code>--lowvram</code>、<code>--lowram</code>；</li>
<li><code>--share</code>请务必搭配<code>--gradio-auth [username]:[password]</code>使用；</li>
<li>纯 CPU 需添加的参数已从<code>--skip-torch-cuda-test --no-half --precision full</code>简化为<code>--use-cpu</code>；</li>
</ul>
<h3 id="ngrok-使用指南">ngrok 使用指南：</h3>
<ul>
<li><strong>注册/登录 ngrok 后，前往<a href="https://dashboard.ngrok.com/get-started/your-authtoken" target="_blank">授权页</a>可获得 Authtoken；</strong></li>
<li>需添加参数<code>--ngrok [Authtoken]</code>，可选参数<code>--ngrok-region [region]</code>，具体参考<a href="https://ngrok.com/docs/ngrok-agent/config#config-region" target="_blank">文档</a>，默认为 us；</li>
<li>使用时请去掉<code>--share</code>参数，但不必去掉<code>--gradio-debug</code>；</li>
<li><strong><font color=#ff6969>webui 默认给的是 http，若访问白屏请将网址改为 https</font></strong>；</li>
<li>webui 会先给出隧道网址，如果找不到可以稍微往上翻翻；</li>
<li><strong>只能同时创建一个隧道，否则报错 Access denied；</strong></li>
<li>个人感觉 ngrok 更加稳定，也更安全，推荐各位尝试。</li>
</ul>
<h3 id="附录azure-ml-体验">附录：Azure ML 体验</h3>
<p>如果你有学生身份，那么便可以免费体验包括 Azure 与 DigitalOcean 在内多个云服务商的 IaaS 基础设施。DigitalOcean 我暂时没有涉足，就先说说有关 Azure 的一点经验。</p>
<ol>
<li>Azure 学生订阅自带 $100，但是你无法直接去购买带 GPU 的 vps，会提示没有配额。因此考虑转向 Azure ML 平台。</li>
<li>Azure ML 提供了最高 16核 32G CPU实例，与 6核 56G 带 Tesla K80/M60 GPU实例，性能其实并不算很好，并且所有的资源都是会扣额度的，除了计算实例，存储，网络都会收费。<br>(当关闭所有实例时，工作区的存储似乎不扣费，免费存储额度暂未知，怀疑 100GB。)</li>
<li>由于环境不同，写 notebook 不是很容易，还是先试试纯 CPU 下的性能吧。(据说跑满一半核心是正常情况)<details><summary>基准测试点击查看。</summary><img src="https://file.sxjeru.top/Blog/images/27.png" alt="" loading="lazy"><img src="https://file.sxjeru.top/Blog/images/28.png" alt="" loading="lazy"></details></li>
<li>上次用 GPU 尝试结果不能出图，之后有时间再试吧。况且按那价格，100刀还不够造 100h 的。x</li>
</ol>
<hr>
<p>说起来，应该没有人是为看图而来的吧。<br>
咱一直在费心于基础设施搭建，哪有空研究咒语啥的，生成的结果只能说堪堪达到“能看”的范畴而已。<br>
唉，AI 对于人体四肢的生成还是不太 Stable 啊——</p>
<!-- 
<img src="smiley" width="" height="" loading="lazy"> 
-->
<img src="smiley" width="" height="" loading="lazy"> 
<img src="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/193f6883-ec30-4b39-843d-0d863b290628/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20221023%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20221023T075207Z&X-Amz-Expires=86400&X-Amz-Signature=33d382ee2f471336cfaf18e99ed25ae0c8eb7d673e79184ed9e3838ae630dcce&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22Untitled.png%22&x-id=GetObject" width="" height="" loading="lazy"> 
                </div>
            </article>
        </div>

        
            <div class="next-post">
                <div class="next gt-c-content-color-first">下一篇</div>
                <a href="https://blog.sxjeru.top/post/10/" class="post-title gt-a-link">
                    现在立刻就想对哥哥说我是妹妹！本体+汉化+特典
                </a>
            </div>
        

        
            <div id="/post/11/" class="leancloud_visitors" style="visibility:visible" data-flag-title="本人对 Stable Diffusion 的全部探索">
            	当前文章阅读量：<span id="/post/11/"
                class="waline-pageview-count leancloud-visitors-count">0</span>
            </div>
        

        

        
            <script src='//file.sxjeru.top/Blog/script/waline.js'></script>
<link href='//file.sxjeru.top/Blog/script/waline.css' rel='stylesheet' />

<style>
	div#waline{
		width:100%;
		max-width: 1000px;
		padding: 2.5%;
	}
</style>


	<div id="waline"></div>

<script>
	Waline.init({
		el: '#waline',
		login: 'enable',
		serverURL: 'waline.sxjeru.eu.org',
		pageSize: 10,
		recordIp: true,
		pageview: true,
		emoji: [
			'//fastly.jsdelivr.net/npm/@waline/emojis@1.0.1/qq',
			'//fastly.jsdelivr.net/npm/@waline/emojis@1.0.1/bilibili',
			'//fastly.jsdelivr.net/npm/@waline/emojis@1.0.1/tw-emoji'
		]
	});
</script>

        

        <div class="site-footer gt-c-content-color-first">
    <div class="slogan gt-c-content-color-first"></div>
    <div class="social-container">
        
            
                <a href="https://github.com/sxjeru" target="_blank">
                    <i class="fab fa-github gt-c-content-color-first"></i>
                </a>
            
        
            
                <a href="https://twitter.com/sxj_eru" target="_blank">
                    <i class="fab fa-twitter gt-c-content-color-first"></i>
                </a>
            
        
            
        
            
        
            
        
            
        
            
        
    </div>
    <div class="footer-info">
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
<br>
<a href="https://www.upyun.com/?utm_source=lianmeng&amp;utm_medium=referral" style="color: rgb(166, 158, 147); text-decoration: none; --darkreader-inline-color:#aaa297;" data-darkreader-inline-color="">本网站由<img src="https://file.sxjeru.top/Blog/又拍云_logo6.png" style="
    vertical-align: middle;
    height: 24px;
    margin: 3px;
">提供CDN/云存储服务</a>
<br>
<a href="https://icp.gov.moe/?keyword=20229980" target="_blank">萌ICP备20229980号</a> | ©Eru's Home 2018-2022
    </div>
    <div>
        Theme by <a href="https://imhanjie.com/" target="_blank">imhanjie</a>, Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>, <a href="https://blog.sxjeru.top/atom.xml" target="_blank">RSS</a>
    </div>
</div>

        <script>
  hljs.highlightAll();
</script>

        <script>
(function() {
	function addEventListener(element, type, handler) {
        if (element.addEventListener) {
            element.addEventListener(type, handler, false);
        } else if (element.attachEvent) {
            element.attachEvent('on' + type, handler);
        }
    }

    addEventListener(window, 'load', function () {
        var Viewer = window.Viewer;
        var pictures = document.querySelector('.post-content');
        var viewer = new Viewer(pictures);
    });
})();
</script>


        <script>
            var ele = document.querySelector(".waline-visitor-count");
            Object.defineProperty(ele, 'innerText', {
                get: function() {
                    return ele.innerText;
                },
                set: function(value) {
                    ele.innerHTML = value;
                    if (value > 0) {
	                    var parent = document.querySelector(".leancloud_visitors");
	                    parent.style.visibility="visible";
	                }
                }
            });
        </script>
    </div>
</div>
</body>
</html>
